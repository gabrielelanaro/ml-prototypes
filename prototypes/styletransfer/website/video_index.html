<!DOCTYPE html>
<html>

<head>
    <title>AWS S3 File Upload</title>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.283.1.min.js"></script>
</head>

<body>
    <input type="file" id="file-chooser" />
    </br>
    </br>
    Your email: <input type="text" id="email">
    </br>
    </br>
    <button id="upload-button">Upload to S3</button>
    </br>
    </br>
    <span id="results"></span>

    <script type="text/javascript">
        AWS.config.region = 'eu-west-1'; // Region

        AWS.config.credentials = new AWS.CognitoIdentityCredentials({
            IdentityPoolId: 'eu-west-1:daac3c5a-13e3-4c7d-80d8-869eacaa0f83',
        });

        var bucketName = 'visualneurons.com-videos'; // Enter your bucket name
        var bucket = new AWS.S3({
            params: {
                Bucket: bucketName
            }
        });

        var fileChooser = document.getElementById('file-chooser');
        var button = document.getElementById('upload-button');
        var results = document.getElementById('results');

        function validateEmail(email) {
            var re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        button.addEventListener('click', function() {
            email = document.getElementById('email').value.toLowerCase();

            if (validateEmail(email) == false) {
                results.textContent = "Please enter a valid email address and try again!"
                setTimeout(function() {
                    results.textContent = ''
                }, 2000);
                return
            }

            var file = fileChooser.files[0];

            if (file) {

                results.textContent = '';
                clean_email = email.replace(/[^a-zA-Z0-9]/g, '')
                var objKey = clean_email + '_' + file.name;
                var params = {
                    Key: objKey,
                    ContentType: file.type,
                    Body: file,
                    Metadata: {
                        'email': email,
                    },
                };

                bucket.putObject(params, function(err, data) {
                    if (err) {
                        results.textContent = 'ERROR: ' + err;
                    } else {
                        results.textContent = "Upload to S3 successful!";
                    }
                });
            } else {
                results.textContent = 'Nothing to upload.';
            }
        }, false);
    </script>
</body>

</html>